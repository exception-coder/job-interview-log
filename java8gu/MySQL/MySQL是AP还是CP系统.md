总结标题：mysql_ap_or_cp

---

## 1）10 行极简速记版（纯文本）

✔ CAP 是分布式系统理论，单主 MySQL 默认不涉及 P
🔥 单主架构 MySQL：只有一个节点提供服务 → AC
📌 主从延迟不影响主库一致性与可用性
⚠️ 从库不参与写入，不属于强一致场景
🚀 开启读写分离后，从库提供读 → 数据信息可能滞后
✨ 主写从读模式 = 典型 AP（牺牲一致性换可用性）
🧠 一致性差异取决于客户端是否读从库
🔍 CAP 不适用于单机或单主结构，但适用于多节点读写架构
📈 MySQL 能是 AC，也能是 AP，取决于部署方式
✘ 不存在固定标签，关键在架构模式

---

## 2）折叠式知识卡片版（Markdown）

<details>
<summary>定义</summary>

文档探讨 MySQL 在 CAP 理论下的分类。MySQL 本身是一个关系型数据库，但其在不同部署模式下呈现不同的 CAP 属性：

* **单主架构**：只有一个节点对外服务 → 无分区问题 → AC
* **读写分离架构**：主写从读 → 网络分区时从库仍可响应 → AP
  因此 MySQL 不是固定的 AP 或 CP，而是根据架构模式表现为 AC 或 AP。

</details>

<details>
<summary>原理</summary>

* **CAP 理论背景**

    * 用于描述分布式系统的可用性（A）、一致性（C）、分区容错性（P）之间的平衡。
    * 单节点系统不具备分区容错问题，因此不涉及 CAP 选择。

* **MySQL 单主模式（主备切换）**

    * 同一时刻仅主库提供读写服务。
    * 分区场景下不允许备库继续写入，保证一致性。
    * 因此具备一致性（C）和可用性（A），即 **AC**。

* **读写分离模式**

    * 主库提供写，从库提供读。
    * 当网络延迟或分区时，从库仍可返回旧数据 → 保证 A，牺牲 C。
    * 这种读写分离架构呈现 **AP** 特征。

</details>

<details>
<summary>关键点</summary>

* MySQL 自身不是分布式数据库，但可通过架构方式形成分布式属性。
* 单主 → 强一致读写，读写均在同一节点，CAP 不适用 → 视为 AC。
* 读写分离 → 数据可能延迟，客户端读取非最新数据 → AP。
* CAP 不讨论事务一致性，而是跨节点一致性。
* 关键因素是“是否允许多个节点同时对外提供数据服务”。

</details>

<details>
<summary>扩展知识</summary>

* MySQL Cluster（NDB）才是真正的 CP/CA 架构的讨论对象，而非普通主从。
* 强一致读写可通过强制读主库、GTID 校验、semi-sync 实现。
* AP 系统中可结合“读写分离 + 最终一致性”策略。
* CAP 讨论的是分布式多节点行为，而 MySQL 默认不是分布式存储引擎。
* 主从延迟不影响主库的一致性，但影响读从库的数据新鲜度。

</details>

---

## 3）面试官追问（Q&A）

**问：为什么单主 MySQL 被认为是 AC？**
答：只有一个节点对外服务，不存在分区容错需求，因此可以同时具备强一致性与可用性。

**问：读写分离为何导致 MySQL 表现为 AP？**
答：从库可以在主库不可达（分区或延迟）时继续返回旧数据，这是保证可用性但丧失一致性的典型 AP 行为。

**问：CAP 的一致性和数据库事务一致性是一回事吗？**
答：不是。CAP 的一致性指跨节点读写一致性，不是 ACID 的 C。

**问：从库延迟是否破坏主库一致性？**
答：不会。因为主库是唯一写入者，它的一致性始终有效；从库只能影响整个系统的客户端一致性。

**问：如何让读写分离的 MySQL 更接近 CP？**
答：使用强制读主、半同步复制、延迟读屏蔽等方式，但可用性下降。

**问：MySQL 原生是否支持 CP？**
答：不支持。要实现 CP，需要分布式数据库架构（如 TiDB、CockroachDB）。

**问：主从延迟如何影响客户端体验？**
答：可能读到旧数据，例如写后立刻读发生穿越读（read-after-write inconsistency）。

---

## 4）示意图（ASCII）

```
          MySQL 在不同架构下的 CAP 特征

                单主架构（主备）
                 ┌──────────┐
                 │   主库    │ ← 唯一读写节点
                 └─────┬────┘
                       │
                     备库（仅在主挂后切换）
 → 无多节点读写 → 无 P → 默认 AC

                读写分离架构
         ┌──────────┐        ┌──────────┐
         │   主库    │ ← 写   │   从库    │ ← 读
         └─────┬────┘        └─────┬────┘
               │ 复制                │
   网络延迟/分区时从库仍可读 → AP（旧数据但可用）
```
