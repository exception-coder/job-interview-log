## 1）10 行极简速记版（小红书爆款风）

✔ CHAR = 定长猛男，空间换速度
🔥 VARCHAR = 变长节省空间，但可能“页分裂”
📌 CHAR 自动补空格，VARCHAR 按实际长度存
🚀 VARCHAR 更新变长 → 页分裂 → 磁盘碎片
🧠 CHAR 不会碎片化，但浪费存储
✨ VARCHAR 要多 1~2 字节记录长度
📈 CHAR 适合固定字段，如身份证/国家码
🔍 VARCHAR 适合描述类、地址类长字段
⚠️ CHAR 会吞尾部空格，数据需谨慎
➤ 核心：稳定长度用 CHAR，波动长度用 VARCHAR

## 2）折叠式知识卡片版

<details>
<summary>定义</summary>

* **CHAR**：定长字符串类型，固定长度，不足自动补空格。
* **VARCHAR**：变长字符串类型，根据实际字符长度动态分配空间。

</details>

<details>
<summary>原理</summary>

* CHAR 会在存储时补足空格，因此无长度变化，更新不会触发页分裂。
* VARCHAR 存储时紧凑排列，更新变长时可能无法原地扩展空间，触发页分裂，造成碎片。
* VARCHAR 会额外消耗 1~2 字节记录长度信息。
* CHAR 因为定长，不需要额外存储长度，但会浪费空间。

</details>

<details>
<summary>关键点</summary>

* CHAR：定长、快、不碎片、会吞尾部空格、浪费存储。
* VARCHAR：节省空间、适合变长字段、但可能产生碎片和页分裂。
* 页分裂会导致磁盘碎片、性能下降。
* 使用场景需考虑字段稳定性、长度变化频率、访问模式。

</details>

<details>
<summary>扩展知识</summary>

文档未提但可补充：

* 页分裂会增加写放大，并导致链式页结构不连续，影响 range 扫描。
* VARCHAR 适合 OLTP 中的长文本，但在更新频繁场景需谨慎。

</details>

## 3）面试官追问（Q&A）

问：CHAR 为什么不会页分裂？
答：因为长度固定，更新不会导致空间需求变化，不会触发重新分布页结构。

问：VARCHAR 为什么会导致页分裂？
答：更新变长后，原位置可能容纳不下新的长度，需要拆页重定位，产生碎片。

问：什么时候必须用 CHAR？
答：字段长度固定且业务要求极高读取性能，比如身份证号、国家代码、订单号。

问：什么时候一定要用 VARCHAR？
答：字段长度变化大，例如地址、描述、昵称等。

问：CHAR 会影响查询结果吗？
答：会吞掉尾部空格，导致字段本身末尾空格丢失。

问：VARCHAR 的额外开销是什么？
答：需要额外 1～2 字节来存储字符串长度。

问：长度选不对会怎样？
答：过长浪费空间，过短造成更新变长频繁，触发页分裂。

问：CHAR 是否更快？
答：是，因为定长访问可直接定位偏移，不需要额外解析长度。

## 4）示意图（ASCII）

```
CHAR vs VARCHAR

CHAR（定长）
┌──────────────┐
│ "abc     "   │ ← 自动补空格
└──────────────┘
优点：无碎片、快速
缺点：浪费空间、吞尾空格

VARCHAR（变长）
┌──────────┬──────┐
│ length=3 │ "abc"│
└──────────┴──────┘
优点：节省空间
缺点：更新变长可能页分裂
```
