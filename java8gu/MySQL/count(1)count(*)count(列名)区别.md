总结标题：count_star_vs_count_1_vs_count_col

---

## 1）10 行极简速记版（纯文本）

✔ count(*) = 统计所有行，不管列值是否为 NULL
✔ count(1) 与 count(*) 在 InnoDB 中执行方式完全一致
🔥 MyISAM 可直接返回缓存的总行数（无 where 条件）
⚠️ InnoDB 无法缓存行数，必须扫表
📌 count(列名) 只统计该列非 NULL 的行
🧠 count(*) 是 SQL 标准语法，MySQL 优化最多
➤ count(列名) 会多一次“是否为 NULL”判断，更慢
🚀 InnoDB 会选择最小的二级索引来加速 count(*)
✨ select count(*) 无 where/group by 时最容易触发优化
📈 性能排序：count(*) ≈ count(1) > count(列名)

---

## 2）折叠式知识卡片版（Markdown）

<details>
<summary>定义</summary>

* **COUNT(*)**：统计结果集中所有行，含 NULL。SQL92 标准，MySQL 优化最充分。
* **COUNT(1)**：与 COUNT(*) 等价，返回符合条件的行数。
* **COUNT(列名)**：统计列值非 NULL 的行数。若列允许 NULL，则结果可能小于总行数。

</details>

<details>
<summary>原理</summary>

* COUNT(*) 与 COUNT(1) 对 InnoDB 来说执行路径相同：扫描行记录并累加计数。
* COUNT(列名) 多走一步：读取列值并判断是否 NULL，产生额外 CPU 开销。
* MyISAM 维护“总行数”元信息，因此 COUNT(*) 在无条件时可 O(1) 返回。
* InnoDB 由于多版本并发控制（MVCC）与行级锁，不记录总行数，必须扫描索引。

</details>

<details>
<summary>关键点</summary>

* **性能：COUNT(*) = COUNT(1) > COUNT(列名)**。
* MySQL 8.0.13+ InnoDB 对 COUNT(*) 在无 where/group by 时进行优化：选择**最小的非聚簇索引**扫描，提高读性能。
* COUNT(列名) 遇到 NULL 会过滤，因此用于“统计字段非空数量”更语义化，但性能弱于 COUNT(*)。
* COUNT(*) 不会展开列值，也不会读取整行，因此比想象中更轻量。

</details>

<details>
<summary>扩展知识</summary>

* InnoDB 聚簇索引叶子节点保存整行，非聚簇索引只保存主键 → 扫描二级索引成本低。
* COUNT(*) 不会触发“回表”，仅扫描索引即可得出行数。
* COUNT(列名) 若列在二级索引中，可避免回表，性能会提升。
* COUNT(expr) 若表达式恒不为 NULL，则行为与 COUNT(1) 相同。

</details>

---

## 3）面试官追问（Q&A）

**问：为什么 InnoDB 的 COUNT(*) 不能像 MyISAM 一样直接返回总记录数？
答：InnoDB 支持事务与 MVCC，行数在不同事务视图中不一致，因此无法维护全局准确行数。**

**问：COUNT(*) 为什么比许多人想象的更快？
答：优化器会选择最小索引扫描，不会读取整行数据，只做简单计数。**

**问：COUNT(列名) 为什么比 COUNT(*) 慢？
答：需要逐行判断列是否为 NULL，增加 CPU 和可能的回表开销。**

**问：COUNT(1) 是否比 COUNT(*) 快？
答：在 InnoDB 中完全等价，无性能差异（官方明确 same way, no performance difference）。**

**问：在有 where 条件时，COUNT(*) 如何执行？
答：需要扫描过滤后的行，无法使用 MyISAM 的 O(1) 行数缓存优化。**

**问：COUNT(*) 能否使用覆盖索引优化？
答：能。只要被扫描的索引包含所需的列（仅需主键或任意索引键），即可避免回表。**

**问：在统计非空行数时，是用 COUNT(列名) 还是 COUNT(*) 更合适？
答：语义上 COUNT(列名) 更准确，COUNT(*) 会包含 NULL 行，不适用于统计非空数量。**

**问：COUNT(*) 为什么最好作为默认写法？
答：语义标准、兼容性好、优化最完善，不依赖特定数据库实现细节。**

**问：COUNT(1) 是否有实际使用价值？
答：无。现代 MySQL 中 COUNT(*) 是最推荐、最优化的写法。**

---

## 4）示意图（ASCII）

```
COUNT 类型对比

            +----------------------------+
            |         COUNT(*)           |
            | 统计所有行（含 NULL）       |
            +--------+-------------------+
                     |
        +------------+--------------+
        |                           |
   InnoDB 扫描最小二级索引     MyISAM 直接返回总行数（无条件）
        |
        v
   高效、无回表、轻量计数

-----------------------------------------------------

            +----------------------------+
            |          COUNT(1)          |
            | 与 COUNT(*) 完全等价       |
            +----------------------------+

-----------------------------------------------------

            +----------------------------+
            |       COUNT(column)        |
            | 统计 column 非 NULL 的行数 |
            +----------------------------+
                     |
                     v
           需要读取字段并判断 NULL
           可能产生回表 → 性能最差
```

---
