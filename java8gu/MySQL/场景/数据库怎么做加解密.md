Database_Encrypt_And_Decrypt
✔ 敏感字段必须脱敏/加密后落库
⚠️ 服务端加密最安全，DB 看不到明文
📌 MySQL 内置 AES/MD5/SHA1 等函数
🧠 静态表空间加密保护落盘数据
🔥 密钥管理是整个安全链路核心
🚀 非对称不常用，对称足够高效
🔍 MD5 仅能匹配，不能解密展示
➤ 加密字段难查询，需额外设计
📈 计算开销高，影响性能
✨ DBA 层可开启 InnoDB 全表空间加密

---

## 折叠式知识卡片版

<details>
<summary>① 定义</summary>

* 数据库加密用于保护敏感字段（手机号、身份证、密码等）不被泄漏。
* 目标：数据库即使被拖库，也无法获取明文。
* 文档涵盖三大方向：服务端加解密、数据库内置加密函数、InnoDB 静态数据加密。

</details>

<details>
<summary>② 原理</summary>

### 1）服务端加解密

* 在写入 DB 前由业务代码执行加密，从 DB 拉取后再解密。
* 数据库只存密文，不掌握密钥 → **最安全模式**。
* 常用对称加密（AES），非对称一般不用于字段加密（性能差）。

### 2）数据库内置加密函数

* **AES_ENCRYPT / AES_DECRYPT**：对称加密，核心是密钥管理。
* **MD5 / SHA1**：不可逆，仅用于匹配（如密码）。
* **DES_ENCRYPT**：已不安全，不推荐。
* **ENCRYPT / PASSWORD**：历史兼容用途，安全性弱。

### 3）InnoDB 静态加密（Transparent Encryption）

* 对表空间、redo/undo 等落盘文件进行透明加密。
* 对业务无侵入，为磁盘数据泄露提供保护。
* MySQL 8.0 支持 schema 级别默认加密。

</details>

<details>
<summary>③ 关键点</summary>

* 服务端加密适合需要展示明文的字段（手机号）。
* MD5 仅用于无法解密的场景（密码）。
* AES 类加密函数依赖**密钥严格保护**，风险点在密钥泄漏。
* DB 侧加密无法解决“模糊查询困难”问题。
* InnoDB 表空间加密保护落盘，但进程内仍是明文。
* 加密会带来 CPU 负载与查询困难，需要按字段精细化加密。

</details>

<details>
<summary>④ 扩展知识</summary>

* 合理补充：可引入 KMS（密钥管理服务）统一托管密钥并自动轮转。
* 搜索/模糊匹配可通过字段拆分、加密索引或同态加密实现（开销较大，文档未提及）。
* 敏感字段常配合脱敏存储（如掩码存储部分信息）。

</details>

---

## 面试官追问（Q&A）

**问：为什么大多数敏感字段用对称加密而非非对称？**
答：非对称加密开销大且密钥管理复杂；字段级场景需要高频加解密，对称加密更高效。

**问：服务端加密相比数据库函数的优势是什么？**
答：DB 永远拿不到密钥，可避免DBA 或漏洞导致的明文泄漏；同时便于集中管理加密逻辑。

**问：为什么加密后无法直接做 like 查询？**
答：密文无序且不可预测，无法利用原有索引，需要额外结构支持（如加密索引或冗余字段）。

**问：静态加密保护什么、不保护什么？**
答：保护落盘文件（表空间与 redo/undo），但不保护运行中的内存数据与明文查询结果。

**问：AES 密钥管理不当的风险是什么？**
答：密钥一旦泄漏，加密数据等于明文，安全性完全失效。

**问：密码为什么不推荐 AES 加密而是 MD5/SHA？**
答：密码无需展示且必须不可逆；AES 可解密反而增加风险。

**问：服务端加密如何提升密钥安全？**
答：密钥存放于 KMS/HSM，应用仅按权限获取；支持轮转与审计。

---

## 示意图（ASCII）

```
        写入路径（服务端加密）
客户端 → 应用服务（AES 加密） → 密文 → 数据库

        读取路径
数据库 → 密文 → 应用服务（解密） → 明文返回

        InnoDB 静态加密
        表空间文件 ——(加密落盘)——→ 磁盘
```

（完）
