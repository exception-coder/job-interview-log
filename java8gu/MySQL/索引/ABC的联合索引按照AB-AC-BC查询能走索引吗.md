总结标题：mysql_compound_index_abc

---

## 1）10 行极简速记版（纯文本）

✔ 联合索引 ABC 必须命中最左前缀 A 才能走索引
🔥 AC 能走索引，但只用到 A，无法跳过 B 用到 C
📌 AB 性能优于 AC，因为连续使用 A→B
⚠️ BC 完全不能走索引（不含 A，破坏最左前缀）
🚀 where 条件顺序无关紧要，优化器会重排
🔍 只要条件中不出现 A，索引 ABC 完全失效
✨ ABC、BAC、CBA 只要包含 A 且不跳 B 才能用上更多字段
🧠 索引跳跃扫描可特殊支持 AC / BC，但需 MySQL 8.0+
📈 最左前缀原则是复合索引使用的核心规则
✘ 跳列查询不会使用被跳过列的索引能力

---

## 2）折叠式知识卡片版（Markdown）

<details>
<summary>定义</summary>

文档讨论一个联合索引 `(A, B, C)` 在不同查询条件组合（A、B、C、AB、AC、BC、ABC 等）下的可用性规则，核心依据是 MySQL 的最左前缀匹配原则：复合索引必须从最左侧列开始连续匹配才能使用。

</details>

<details>
<summary>原理</summary>

* **最左前缀匹配原则**：

    * 联合索引 `(A, B, C)` 被存储为以 A 开头的有序结构；
    * 想要利用索引，查询条件必须从 A 开始连续命中；
    * 若跳过 A（如只使用 B、C、BC），索引无法利用。

* **对不同查询组合的影响**：

    * **A**：可用索引
    * **AB**：可用 A、B 连续索引
    * **AC**：可用索引，但只能使用 A（跳过 B 使 C 失效）
    * **BC**：完全无法使用索引
    * **ABC**：连续命中三列，全部使用索引
    * **顺序无关**：WHERE 条件顺序不影响索引匹配（例如 BA 与 AB 等同）。

* **MySQL 8.0 的索引跳跃扫描（Index Skip Scan）**：

    * 在特定条件下允许跳过前缀的扫描，理论上 AC、C 查询也可能利用索引；
    * 但需满足特定列选择性，且仍不如连续前缀高效。文档中暂未讨论此机制。

</details>

<details>
<summary>关键点</summary>

* A 是联合索引的入口键，没有 A 就无法定位索引树。
* AB 与 BA 无差别，优化器会自动重写条件。
* AC 虽包含 A，但由于跳过 B，不可利用 C 的索引组织结构。
* XX 查询能否走索引依赖“最左开始 + 连续匹配”，跳过即断裂。
* 对于只想用 B、C 的场景，应建立独立索引或不同顺序的联合索引。

</details>

<details>
<summary>扩展知识</summary>

* 联合索引的列顺序应基于“高选择性优先”原则设计。
* 多列联合条件的顺序不影响索引匹配，但影响优化器成本判断。
* 覆盖索引能够减少回表，但仍依赖最左前缀匹配才能命中索引结构。
* MySQL 8.0 的 Skip Scan 虽允许跳过前缀，但性能不如正确设计索引。
* 索引字段之间有依赖时（如范围查询），会中断后续列的使用。

</details>

---

## 3）面试官追问（Q&A）

**问：为什么 AC 查询不能完全利用 ABC 索引？**
答：因为 C 设计在 B 后面，跳过 B 会破坏索引树的有序结构，导致无法基于 C 定位范围，只能利用 A 部分。

**问：为什么 BC 查询完全无法使用索引？**
答：因为联合索引的最左列 A 未命中，数据库无法定位索引树根节点。

**问：WHERE 顺序会影响索引命中吗？**
答：不会。优化器会根据索引结构重写条件顺序，BA 和 AB 效果相同。

**问：联合索引顺序如何设计？**
答：通常遵循“选择性高的字段放前面”或“查询中出现频率最高的列优先”的原则。

**问：索引跳跃扫描能否解决 AC、BC 无法走索引的问题？**
答：在 MySQL 8.0+ 中有可能，但 Skip Scan 成本高且不稳定，不能替代合理的索引设计。

**问：为什么 ABC 查询中所有条件顺序不同结果相同？**
答：因为优化器会将条件按索引顺序重排，保证最左前缀匹配。

**问：是否应该给 B、C 再分别建单列索引？**
答：取决于业务查询模式，如果存在大量 BC 模式或只查 B/C 的 SQL，需补充单列或调整联合索引顺序。

---

## 4）示意图（ASCII）

```
联合索引 (A, B, C) 的最左前缀匹配结构：

A → B → C
│    │    └─ 可用仅在 AB 连续匹配时
│    └─ 若跳过 B（如 AC 查询）则 C 部分失效
└─ 若未命中 A（如 BC 查询）索引完全失效

查询能走索引情况总结：
A      ✓
AB     ✓✓
AC     ✓（仅 A）
ABC    ✓✓✓
BC     ✗
```
