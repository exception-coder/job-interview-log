✔ InnoDB 主力索引结构是 B+Tree
🚀 Hash 索引用于自适应哈希加速等值查找
📌 聚簇索引叶子节点保存整行数据
🧠 非聚簇索引叶子节点只存索引值 + 主键
⚠️ 唯一索引要求索引列值唯一
🔥 FULLTEXT 在 5.6+ 支持，ngram 支持中文
🔍 无主键会选择唯一非空索引或创建隐藏主键
📈 二级索引查询最终需回表获取行数据
➤ 索引类型影响存储、查询路径和锁行为
✔ B+Tree 更适合范围扫描、排序、一致性锁

---

## 2）折叠式知识卡片版

<details>
<summary>定义</summary>

* **B+Tree 索引**：InnoDB 主要索引结构，用于范围查询、排序、等值检索。
* **Hash 索引**：自适应生成，用于等值查询加速，不支持范围扫描。
* **聚簇索引（Clustered Index）**：主键索引，叶子节点即整行数据。
* **非聚簇索引（Secondary Index）**：叶子节点存储索引列 + 主键值。
* **唯一索引（Unique Index）**：列值必须唯一。
* **全文索引（Fulltext Index）**：5.6+ 支持，5.7+ 通过 ngram 支持中文。

</details>

<details>
<summary>原理</summary>

* 聚簇索引决定数据在磁盘中的物理组织方式，主键按顺序构建 B+Tree。
* 非聚簇索引指向主键值，通过回表获取完整行记录。
* Hash 索引通过 InnoDB 自适应哈希功能在热点查询上自动构建。
* 唯一索引通过加锁与判断重复实现唯一性校验。
* FULLTEXT 适合分词与倒排索引结构，适配全文检索场景。

</details>

<details>
<summary>关键点</summary>

* 主键选择影响所有二级索引的大小（因为叶子节点包含主键）。
* 二级索引无法直接定位行数据，必须依赖主键回表。
* Hash 索引不参与排序、不适合区间查找。
* InnoDB 默认必须有主键；没有则会自动生成隐藏 ID。
* FULLTEXT 在结构与使用场景上完全不同于 B+Tree。

</details>

<details>
<summary>扩展知识</summary>

* 二级索引可能导致回表开销大，可通过覆盖索引优化。
* 唯一索引在并发下会触发额外锁竞争（插入/更新路径）。
* B+Tree 分裂/合并影响写放大，需要合适的主键设计。
* FULLTEXT 受分词器影响（ngram/ICU），中文适配策略不同。

</details>

---

## 3）面试官追问（Q&A）

**问：为什么 InnoDB 使用 B+Tree 而不是 B 树？**
答：B+Tree 仅在叶子节点存储数据，提高磁盘页利用率，支持更高扇出，树高度更低。

**问：为什么二级索引必须回表？**
答：因为叶子节点只有索引列 + 主键值，不包含整行记录内容。

**问：聚簇索引一定是主键吗？**
答：是。没有主键时会选择唯一非空索引，否则创建隐藏 primary key。

**问：Hash 索引能否加快范围查询？**
答：不能，Hash 无序，不支持区间查找、排序、最左匹配等操作。

**问：唯一索引如何保证唯一性？**
答：通过对目标索引项加锁 + 版本检查，确保并发插入时冲突失败。

**问：全文索引与普通索引的最大差异是什么？**
答：全文索引用倒排索引和分词机制，不适用于结构化范围查询。

**问：为什么主键越短越好？**
答：因为二级索引叶子包含主键值，主键越大每个二级索引越膨胀，降低缓存命中率。

**问：自适应哈希索引什么时候启用？**
答：InnoDB 自动检测热点页的等值查询频率，满足阈值后自动生成 Hash 索引。

---

## 4）示意图（ASCII）

```
        InnoDB 索引体系
        ----------------------
        |    主键（聚簇索引） |
        |  叶子节点=整行数据  |
        ----------------------
               ↑  回表
        ----------------------
        |  二级索引（非聚簇） |
        |  索引值 + 主键值    |
        ----------------------
               ↑  自动构建
        ----------------------
        |  自适应 Hash 索引   |
        |  等值查询加速       |
        ----------------------
```
