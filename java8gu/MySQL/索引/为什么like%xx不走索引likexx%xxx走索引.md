### mysql_like_prefix_matching

#### 1）10 行极简速记版（纯文本）

✔ LIKE 必须满足最左前缀才能走索引
✘ '%xx' 因前缀未知必定全表扫描
✔ 'xx%' 可用索引范围查找
🔥 'xx%xxx' 依旧按 'xx%' 前缀走索引
📌 B+Tree 按前缀有序，后缀完全无序
⚠️ 前缀丢失 = 索引定位能力丢失
🔍 '%xx' 会触发全字段匹配比较
📈 前缀越长过滤效果越好
🧠 MySQL 不支持后缀索引匹配
✨ 根因：索引是按“开始部分”排序的

---

#### 2）折叠式知识卡片版

<details>
<summary>定义</summary>

LIKE 是 SQL 中的模糊匹配方式。当使用 `%` 通配符时，是否能利用索引取决于是否满足 B+Tree 索引的最左前缀法则：匹配必须从字段最左侧开始才能利用索引范围扫描。

</details>

<details>
<summary>原理</summary>

* B+Tree 索引对字符串按左侧字符进行字典序排序。
* 匹配模式若无法确定左侧字符（如 `%xx`），就无法定位索引的扫描起点，必须逐行比较 → 全表扫描。
* 若匹配模式能确定左侧前缀（如 `xx%xxx`），即便后面继续包含字符或 `%`，依然可以通过前缀定位范围 → 走索引。
* 后缀或包含 `%` 的部分不会影响索引是否可走，只影响回表过滤量。

</details>

<details>
<summary>关键点</summary>

* LIKE '%xx' **无法走索引**，因为前缀未知。
* LIKE 'xx%'、LIKE 'xx%xxx' **都能走索引**，因为前缀已确定。
* 索引结构只支持从最左边开始的顺序查找，不支持反向或中间字符起跳。
* `'%…'` 模式等价于扫描所有行再逐行字符串匹配。
* 前缀越长，索引过滤性越强，性能越好。

</details>

<details>
<summary>扩展知识</summary>

* 若必须做后缀匹配，可考虑反转字段值、HASH 索引、全文索引（InnoDB FTS）、ElasticSearch。
* 组合索引同样必须满足最左前缀：LIKE 必须作用在最左列上才可利用索引。
* 避免对索引列使用函数（如 `LOWER(name)`）会导致索引失效。
* 某些场景可使用前缀索引提升 LIKE 'xx%' 的过滤性能。

</details>

---

#### 3）面试官追问（Q&A）

**问：为什么 '%xx' 不能走索引？**
答：因无法根据后缀“xx”定位索引的起始位置，B+Tree 只按最左前缀排序，必须扫描全表逐行比对。

**问：LIKE 'xx%' 和 LIKE 'xx%xxx' 有什么差别？**
答：索引使用一致，都按 'xx' 做范围扫描，只是后者会在索引过滤后再比较尾部字符。

**问：为什么 LIKE 必须满足最左前缀？**
答：B+Tree 索引有序性仅体现在最左边的前缀字符，后续字符无序，不可直接定位。

**问：LIKE '%xx' 是否一定全表扫描？**
答：是，无法利用索引，InnoDB 必须逐行读取并比较。

**问：如果既要后缀匹配又想高性能怎么办？**
答：典型方案是（1）反转字段存入镜像列（2）创建全文索引（3）外部搜索引擎（ES）。

**问：组合索引下 LIKE 可以利用索引吗？**
答：可以，但必须在组合索引的第一列进行前缀匹配，否则失效。

**问：LIKE 'xx%' 是否一定走索引？**
答：大概率走，但若索引选择性极差或统计信息不准，优化器可能放弃索引。

---

#### 4）示意图（ASCII）

```
B+Tree 索引结构（按最左前缀排序）

a…      b…      c…      d…      e…
│        │        │        │        │
├─aaa    ├─bbx    ├─ccm    ├─ddq    ├─ezz
├─aab    ├─bby    ├─ccn    ├─ddr    ├─ezz
└─aac    └─bbz    └─cco    └─dds    └─faa

LIKE 'bb%'    → 可从 'bb' 范围开始扫描
LIKE '%bb'    → 无法定位，从 a… 全表扫描
LIKE 'bb%xx'  → 仍按 'bb' 范围扫描
```

如果你需要，我可以继续生成「LIKE 性能优化指南」「索引最左前缀法则深度解析」。
