总结标题：index_used_but_query_still_slow

---

## 1）10 行极简速记版（纯文本）

⚠️ 用了索引不代表一定快
✔ 优化器可能选错索引导致性能更差
🔥 数据分布极不均匀时索引选择性崩溃
📌 SQL 写法不当会放大回表与扫描成本
🧠 表结构差会导致读取路径复杂、跨多页
➤ 多表 join / select * 容易触发低效执行
🚀 覆盖索引能极大提升性能
🔍 索引区分度是关键，不高就近似全表扫
✨ 索引只是访问路径，不优化 SQL 等于白搭
📈 性能瓶颈可能来自网络 / IO / CPU 而非索引

---

## 2）折叠式知识卡片版（Markdown）

<details>
<summary>定义</summary>

“用了索引但仍然很慢”指的是执行计划显示走了某个索引，但实际执行性能仍然不理想。
索引只是一种访问路径，不是性能保证，最终执行效率取决于多个因素。

</details>

<details>
<summary>原理</summary>

* MySQL 优化器基于统计数据选择索引，但统计误差可能导致 **选错索引**。
* 数据分布严重倾斜时，索引过滤效果差，访问行数接近全表。
* SQL 写法不佳（如扫描大量列、复杂 join、函数运算）可能抵消索引优势。
* 表结构设计不合理可能导致回表次数高、跨页访问多。
* 性能并非只由索引决定，还依赖 IO、CPU、事务锁、网络等系统因素。

</details>

<details>
<summary>关键点</summary>

常见导致“用了索引仍然很慢”的原因：

* **索引选错**：多个索引可用时优化器选择了更差的一个。
* **数据分布不均匀**：高基数 vs 低基数，极端情况下索引几乎无过滤能力。
* **SQL 写法差**：select *、多表 join、函数封装字段、like '%xxx' 等都会导致低效路径。
* **表设计不合理**：字段冗余、复合索引缺失、主键过长、行格式过重。
* **系统层瓶颈**：磁盘 IO、内存不足、CPU 竞争、网络延迟等都会压垮查询性能。

结论：
索引 ≠ 性能好，索引只是“可能更快”。真正速度来自合理 SQL + 正确索引 + 健康数据分布 + 系统资源。

</details>

<details>
<summary>扩展知识</summary>

* 覆盖索引可避免回表，是提升查询速度最有效手段之一。
* 多列索引要严格保证最左前缀原则，否则可能无法使用索引。
* 数据倾斜时可通过 histogram、强制索引（FORCE INDEX）辅助优化器。
* 定期收集统计信息可避免索引选择错误。
* 锁等待（尤其是行锁、gap lock）也可能表现为“用了索引但很慢”。

</details>

---

## 3）面试官追问（Q&A）

**问：为什么优化器会选错索引？
答：基于统计信息估算成本，但统计信息可能过期、不准确，导致误判。**

**问：什么叫数据分布不均导致索引失效？
答：特定值出现过于集中，过滤性差，扫描行数接近全表。**

**问：select * 为什么会拖慢索引查询？
答：需要回表读所有列，增加随机 IO 与页访问次数。**

**问：如何判断索引是否真的被高效使用？
答：看 rows、filtered、extra 中是否包含 using index/using where/using filesort。**

**问：什么情况下应 FORCE INDEX？
答：当优化器持续选错索引且你确信另一个索引过滤性更优时。**

**问：数据倾斜导致的慢查怎么解决？
答：建立复合索引、优化 where 条件、使用直方图提高估算准确性。**

**问：join 时用了索引还会慢吗？
答：会。驱动表选择错误、回表过多、关联字段区分度差都可能拖垮性能。**

**问：为什么 IO/CPU 也会让索引查询慢？
答：索引读取仍需要随机 IO，磁盘慢或 buffer pool 小都会放大延迟。**

**问：锁等待如何导致“索引很慢”？
答：SQL 本身快，但被其他事务持锁阻塞，看起来就像慢查询。**

---

## 4）示意图（ASCII）

```
“用了索引但很慢”的常见原因框架

                  +-------------------------+
                  |     用了索引但很慢      |
                  +-----------+-------------+
                              |
    +-------------------------+----------------------------+
    |                         |                            |
索引相关问题           SQL / 表结构问题              系统/环境问题
    |                         |                            |
    v                         v                            v
选错索引             select * / 多表 join           IO 瓶颈 / CPU 累积
数据分布差           无覆盖索引/回表多              网络延迟
统计信息过期         复合索引缺失                    锁等待/事务阻塞
```

---
