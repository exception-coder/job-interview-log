总结标题：mysql_low_cardinality_index

---

## 1）10 行极简速记版（纯文本）

✔ 区分度低不等于索引没用
📌 关键看“过滤比例”，不是“值的种类数”
🔥 男/女 95:5 时查女依然能走索引且很快
➤ 状态字段常用：INIT 少、SUCCESS 多 → 索引有效
🧠 优化器基于成本决定是否使用索引
⚠️ 区分度低但占比极不均衡时反而很适合建索引
📈 热点扫描场景（任务表轮询）更依赖此类索引
✨ 索引价值 = 是否能显著减少扫描行数
🚀 真实业务数据分布比理论区分度更关键

---

## 2）折叠式知识卡片版（Markdown）

<details>
<summary>定义</summary>

索引区分度（cardinality）表示字段中不同值的数量与总行数的比例。
常见误区：**区分度低 → 不能建索引**。
实际上，是否建索引取决于“过滤效果”，而非区分度本身。

</details>

<details>
<summary>原理</summary>

MySQL 优化器使用基于成本的模型（CBO）评估索引是否可提升性能：

* 如果条件能大幅减少扫描行数 → 倾向使用索引
* 若条件过滤能力弱 → 扫表成本更低，可能不走索引

即使字段只有 *两个值*，但当数据分布极端不均匀（如95% 对 5%）时，使用少数那边的条件做查询，仍能过滤掉绝大部分记录 → 索引非常有效。

</details>

<details>
<summary>关键点</summary>

* **区分度低≠无效索引**，关键在于字段值分布是否不均衡
* 极端不均衡的二值字段非常适合索引（如任务状态 INIT/SUCCESS）
* 优化器选择索引的依据：预估的扫描行数，而不是值的数量
* 在轮询任务类场景中，索引可显著提升扫描效率
* 当条件经常过滤“大部分数据”时，索引越有价值

</details>

<details>
<summary>扩展知识</summary>

适合在区分度不高字段建索引的典型场景：

* 任务调度系统：status = INIT（1%）
* 用户体系：is_deleted、is_active、is_vip（极少数为 1）
* 风控：is_risk_user、is_blacklist
* 业务逻辑常过滤“小部分记录”的标志位字段

不适合作此类索引的情况：

* 两个值比例接近 50:50
* 条件用于排序而非过滤
* 查询经常混合其它无索引字段导致回表成本过高

</details>

---

## 3）面试官追问（Q&A）

**问：区分度与索引选择的关系是什么？**
答：区分度影响过滤能力，但优化器最终依据扫描成本做决定。

**问：在区分度低的字段上什么时候应该建索引？**
答：当某些值占比极小、查询经常只查该值时，例如 INIT 状态。

**问：为什么性别字段一般不建索引？**
答：男女通常接近 50:50，过滤效果弱，走索引反而成本更高。

**问：优化器依据什么决定是否走索引？**
答：依据统计信息推算扫描行数和回表成本（CBO）。

**问：区分度低却走索引的典型场景？**
答：任务表扫描 INIT 状态（极少），过滤比例极高。

**问：区分度高但仍然不走索引可能是什么原因？**
答：数据分布不均、统计信息过期、索引不满足前缀匹配等。

**问：如何验证某字段是否适合建索引？**
答：查看值分布（COUNT(*) 分组）、计算过滤比例、EXPLAIN 实验。

**问：索引区分度越高越好吗？**
答：一般更有利，但仍需结合查询场景分析。

---

## 4）示意图（ASCII）

```
示例：字段区分度低但过滤效果强

性别字段：
   男：95%
   女：5%

查询：WHERE gender='女'

扫描情况：
   索引 → 只扫描 5% 行 → 高效
   全表扫描 → 扫描 100% 行 → 低效

索引收益 = 高过滤比例，而不是值的多样性
```

---
