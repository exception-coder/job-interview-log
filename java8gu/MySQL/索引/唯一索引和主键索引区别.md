Unique_Index_vs_Primary_Key
✔ 主键是“唯一索引+更多约束”的超集
📌 主键唯一且不可为 NULL，唯一索引可为 NULL
🧠 InnoDB：主键=聚簇索引，唯一索引=二级索引
🔥 没有主键时，唯一索引可能被选为聚簇索引
➤ 主键查询永不回表；唯一索引通常需要回表
🚀 一张表只能有一个主键，却可有多个唯一索引
⚠️ 外键只能引用主键，不能引用唯一索引
✨ 索引结构差异决定了查询路径差异

---

## 折叠式知识卡片版

<details>
<summary>① 定义</summary>

* **主键索引（Primary Key Index）**
  强唯一性 + 非空 + 唯一且只能存在一个；在 InnoDB 中即聚簇索引（数据按主键排序存储）。
* **唯一索引（Unique Index）**
  保证列数据唯一，但允许 NULL；可创建多个，通常为非聚簇索引。

</details>

<details>
<summary>② 原理</summary>

* InnoDB 将 **主键** 作为聚簇索引，其 B+Tree 叶子节点存储整行数据。
* **唯一索引** 为二级索引，其叶子节点存储主键值 → 查询时需要“回表”取行数据。
* 若表无主键：

    * InnoDB 会选择第一个非 NULL 的唯一索引作为聚簇索引（文档明确说明“通常”）。
* 主键与唯一索引都保证唯一性，但主键约束更严格。

</details>

<details>
<summary>③ 关键点</summary>

* 主键不允许 NULL；唯一索引允许多个 NULL。
* 查询走主键索引 → 不回表；唯一索引 → 通常需回表。
* 外键只能引用主键，不允许引用唯一索引。
* 表中仅能存在一个聚簇索引，因此只有主键或被选为主键的唯一索引可以成为聚簇索引。
* 主键通常为自增字段以减少页分裂、提升写效率（文档引用链接）。

</details>

<details>
<summary>④ 扩展知识</summary>

* 若唯一索引被选为聚簇索引，则主键的逻辑变为二级索引 → 主键查询需回表（合理补充）。
* 联合唯一索引可用于确保业务字段组合唯一，但仍不替代主键的语义作用（合理补充）。
* 自增主键带来的插入顺序性可显著提升 B+Tree 写入性能。

</details>

---

## 面试官追问（Q&A）

**问：为什么主键查询不需要回表？**
答：主键索引是聚簇索引，叶子节点即整行数据；而唯一索引叶子节点只存主键值。

**问：唯一索引为什么允许 NULL？**
答：唯一约束对 NULL 不做等值限制，多个 NULL 不冲突；主键必须明确表示唯一行 → 禁止 NULL。

**问：没有主键会发生什么？**
答：InnoDB 会选择一个非 NULL 唯一索引作为聚簇索引；若没有，内部生成隐藏 row_id。

**问：主键与唯一索引在性能上的主要差别？**
答：唯一索引查询一般需要二次查找（回表），主键不需要，因此主键路径更短、更快。

**问：什么时候唯一索引可能比主键更合适？**
答：当业务字段天然唯一（如 email、身份证号）但不适合作为聚簇键时，可用唯一索引保证约束。

**问：为什么不能用唯一索引替代主键？**
答：唯一索引没有非空限制、不能被外键引用、不能承载聚簇索引的主导地位。

**问：联合唯一索引能否实现“联合主键”？**
答：可以实现约束功能，但不具备主键的不可为 NULL、外键引用等语义作用。

---

## 示意图（ASCII）

```
              InnoDB 索引结构对比

         主键索引（聚簇）                唯一索引（二级）
      ┌──────────────────┐         ┌──────────────────┐
      │ PK B+Tree         │         │ Unique B+Tree     │
      │ 叶子 = 全行数据    │         │ 叶子 = 主键值      │
      └─────────┬────────┘         └─────────┬────────┘
                │                                │
                ▼                                ▼
          直接返回结果                   回表：再去 PK B+Tree 找整行
```

（完）
