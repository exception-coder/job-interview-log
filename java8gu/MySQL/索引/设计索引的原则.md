sheji_suoyin_de_yuanshi

✔ 高频查询优先建索引，低频查询别乱加
🚀 区分度越高越适合作索引列
📌 联合索引优先覆盖常用查询模式
🧠 覆盖索引可避免回表，大幅加速
⚠️ 索引太多会拖慢写入与占用空间
🔥 字符串长字段应使用前缀索引
🔍 索引顺序必须满足最左前缀匹配
📈 索引长度要“够用即可”避免过短或过长
➤ 索引类型（B+Tree/全文/Hash）需按查询模式选择
✔ 执行计划必须长期观测并动态调整

---

## 2）折叠式知识卡片版

<details>
<summary>定义</summary>

* **索引设计原则**：根据查询模式、数据分布、业务访问路径选取合适的列、合适的顺序与合适的索引类型。
* 涉及：区分度、索引类型、覆盖索引、联合索引、最左前缀、索引成本等。

</details>

<details>
<summary>原理</summary>

1. 索引本质是以更高代价的写放大换更低代价的读放大。
2. 高区分度列能大幅减少扫描行数，降低成本。
3. 联合索引按最左前缀组织，对查询命中率影响巨大。
4. 覆盖索引避免回表，是性能提升效果最直接的方法。
5. 前缀索引减少索引块大小，提高缓存命中率。
6. 索引冗余会增加维护成本（INSERT/UPDATE/DELETE）。

</details>

<details>
<summary>关键点</summary>

* **查询频率最高**的一定打索引；非核心查询不一定需要。
* **区分度**是建索引最关键指标，高选择性列能有效过滤数据。
* 联合索引比多个单列索引更有效，但要遵守最左前缀。
* 覆盖索引减少 IO，可显著提升 QPS。
* 索引字段过长影响 B+Tree 深度与缓存效率。
* 索引数量过多会增加写入延迟与死锁概率。
* 执行计划需持续跟踪，优化器可能选错索引。

</details>

<details>
<summary>扩展知识</summary>

* 索引类型包括：B+Tree、Hash、Fulltext，各有适用场景。
* 数据倾斜场景下，即使区分度不高也可能有效（如严重 95/5 分布）。
* 联合索引字段过多会导致维护成本巨大，不宜滥用。
* 通过 profile/explain 分析可以判断是否走索引、是否回表、是否下推过滤。

</details>

---

## 3）面试官追问（Q&A）

**问：为什么区分度决定索引效果？**
答：选择性越高，可过滤的数据越多，扫描行数越少，IO 越低，索引价值越大。

**问：联合索引为什么比多个单列索引更快？**
答：联合索引能够在一次 B+Tree 遍历中使用多个字段过滤，而多个单列索引只能用于单字段过滤并需要回表交集。

**问：前缀索引的取舍是什么？**
答：降低索引大小/提高缓存 vs. 可能降低区分度。需按字段分布选择前缀长度。

**问：索引为什么不能太多？**
答：每条 DML 都需维护所有索引；过多索引会导致写放大、锁竞争、空间膨胀。

**问：如何判断是否需要创建联合索引？**
答：观察 where、order by、group by 中字段组合出现的频率，优先按最常见组合设计。

**问：执行计划是否永远可靠？**
答：不一定。优化器可能因统计信息过期选错索引，需要 analyze table 或强制 hint。

**问：如何处理区分度低但业务常查的字段？**
答：结合数据倾斜、联合索引、前缀索引综合判断。

---

## 4）示意图（ASCII）

```
              索引设计思路
-------------------------------------------------
1. 业务访问模式 → 2. 选择性分析 → 3. 索引类型
                     |
                     v
4. 联合索引顺序/最左前缀  → 5. 覆盖索引优化
                     |
                     v
6. 执行计划跟踪/调整  → 7. 持续评估写放大成本
```
