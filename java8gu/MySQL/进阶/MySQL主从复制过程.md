总结标题：mysql_master_slave_replication

---

## 1）10 行极简速记版（纯文本）

✔ 主从复制核心依赖 binlog
🚀 本质是“从库拉、主库推响应”
📌 I/O 线程负责拉 binlog → 写入 relay log
🧠 SQL 线程负责重放 relay log → 应用到从库
⚠️ 复制异步，主库挂了可能丢事务
✨ 半同步：至少一个从库确认才返回
🔥 全同步最安全但最慢
➤ binlog 格式决定复制内容（row/statement/mixed）
📈 主从延迟多因从库性能低或大事务
🔍 并行复制可显著降低延迟

---

## 2）折叠式知识卡片版（Markdown）

<details>
<summary>定义</summary>

MySQL 主从复制是一种基于 binlog 的数据同步机制。主库将数据变更写入 binlog，从库通过拉取、写入 relay log、重放 SQL 的方式保持数据一致。

</details>

<details>
<summary>原理</summary>

整体流程：
1）从库启动复制，创建 **I/O 线程 & SQL 线程**
2）从库 I/O 线程连接主库，相应主库创建 **dump 线程**
3）从库告诉主库 binlog 起始位置
4）主库记录事务 → 写 binlog
5）dump 线程读取 binlog，从库 I/O 线程负责**拉取**
6）I/O 线程将事件写入 **relay log**
7）从库 SQL 线程读取 relay log，解析成真实操作并落盘

关键点：

* 复制模式是“从库拉，主库响应”，并非主动推送
* relay log 是从库的中间日志，用于解耦同步与应用

</details>

<details>
<summary>关键点</summary>

* 主从交互线程：dump（主）/ I/O（从）/ SQL（从）
* binlog 是复制的唯一数据源
* relay log 存放从库已拉取但未执行的事件
* 不同 binlog 格式影响复制一致性和性能
* 复制延迟来源：从库性能弱、大事务、I/O 压力
* 半同步复制通过等待至少一个从库确认保障更高一致性

</details>

<details>
<summary>扩展知识</summary>

**三种复制模式**

* **异步复制（默认）**：主库提交即返回 → 有丢失风险
* **半同步复制**：至少一个从库写入 relay log 才返回
* **全同步复制**：需所有从库确认 → 最强一致最慢

**主从延迟来源**：网络、从库慢、SQL 重放慢、大事务、锁冲突等
**并行复制**：按事务组或库/表级并发执行，减少延迟

</details>

---

## 3）面试官追问（Q&A）

**问：MySQL 主从复制的核心是什么？**
答：binlog，所有复制行为都是基于它完成。

**问：为什么说复制是从库拉取而不是主库推送？**
答：官方实现中从库 I/O 线程主动发起请求，便于管理同步偏移及容错。

**问：relay log 存在的意义是什么？**
答：解耦 binlog 拉取与 SQL 应用，便于断点续传和并行复制。

**问：异步复制可能丢数据吗？**
答：可能。在主库崩溃且从库尚未拉取 binlog 时会产生数据缺失。

**问：半同步复制的安全性在哪里？**
答：主库提交必须等待至少一个从库接收到 binlog，降低丢事务概率。

**问：并行复制解决了什么问题？**
答：加速 relay log 的重放能力，减少主从延迟。

**问：什么情况下主从延迟最严重？**
答：大事务、从库性能弱、多表更新、磁盘 I/O 压力高时。

---

## 4）示意图（ASCII）

```
          +------------------------+
          |        主库 (Master)   |
          |  binlog ← 写入事务     |
          +-----------+------------+
                      |
                Dump 线程读取 binlog
                      |
                      v
          +-----------+------------+
          |      从库 (Slave)       |
          |  I/O线程 ← 拉取 binlog  |
          |  写入 relay log         |
          |  SQL线程 → 重放事件     |
          +-------------------------+
```

---
