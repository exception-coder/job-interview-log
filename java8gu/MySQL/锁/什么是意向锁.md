✔ 意向锁是表级锁，不直接锁记录
🚀 用于声明将要加行锁，加速冲突判断
📌 IS 表示将加共享锁，IX 表示将加排他锁
🧠 行锁前必须先持有对应意向锁
⚠️ 意向锁由 MySQL 自动加，不由用户显式请求
🔥 表级锁申请前先检查意向锁避免遍历全表
🔍 意向锁与行锁不冲突，只与表级锁冲突
📈 IS/IX 之间兼容，但与表级 S/X 锁存在冲突矩阵
➤ 作用是“声明意图”，不是“加锁资源”
✔ 事务提交/回滚后意向锁自动释放

---

## 2）折叠式知识卡片版

<details>
<summary>定义</summary>

* **意向锁（Intention Lock）**：表级声明性锁，用于表明事务将要在某些行上加 S 或 X 锁。
* 类型：

    * **IS（Intention Shared）**：声明将加共享锁。
    * **IX（Intention Exclusive）**：声明将加排他锁。

</details>

<details>
<summary>原理</summary>

* 当事务要在某行加 S/X 锁时，InnoDB 会先在表上自动加 IS/IX。
* 表级锁申请者可通过检查意向锁快速判断是否允许加表锁，而无需遍历行锁。
* IS/IX 是 **自动管理** 的，不由用户显式加；它们本身不锁行，仅用于加锁协议协调。
* IS/IX 与行级锁兼容，但与表级 S/X 锁存在冲突规则，从而防止加锁冲突。

</details>

<details>
<summary>关键点</summary>

* 意向锁存在的目的：解决 **表锁与行锁之间的并发冲突判定问题**。
* 事务先持有意向锁，再对行加 S/X 锁，形成两级锁协议。
* 意向锁不限制其他事务对不同记录加锁，因此不会降低并发性。
* 表级锁申请会被已有的意向锁阻止（例如有 IX 时无法加表级 S）。

</details>

<details>
<summary>扩展知识</summary>

* IS/IX 之间兼容，但 IX 会阻塞表级 S/X。
* 表级锁本身很重，常用于 DDL（如 MDL），意向锁用于保障 DDL/行锁互斥判断。
* 意向锁是行级锁体系与表级锁体系之间的“桥梁”。
* 不属于 MVCC 范畴，与快照读无直接关系。

</details>

---

## 3）面试官追问（Q&A）

**问：为什么需要意向锁？**
答：为了避免表锁申请时遍历全表行锁，通过表级意向标记快速判断是否存在冲突。

**问：IS/IX 是否会阻塞行级锁？**
答：不会，它们仅是声明意图，实际行级锁冲突由 S/X 判定。

**问：意向锁由谁加？需要 SQL 写吗？**
答：由 InnoDB 自动加，无需在 SQL 中手动声明。

**问：意向锁是否影响并发？**
答：不影响，它仅阻断表级锁，不阻断行锁，因此能保持高并发能力。

**问：IS 和 IX 谁更强？**
答：IX 更强，因为它声明将加排他锁，与表级 S/X 均有潜在冲突。

**问：意向锁与 MDL 锁冲突吗？**
答：MDL 主要用于 DDL，不与行级意向锁直接冲突，但表级锁判定会考虑意向锁存在。

**问：意向锁是否参与死锁？**
答：通常不参与，死锁主要发生在行级锁（S/X）的资源竞争上。

---

## 4）示意图（ASCII）

```
                   表级锁层
            +------------------------+
            |   IS / IX （声明意图）   |
            +------------------------+
                       |
                       v
                  行级锁层
        +------------------------------+
        |     S（共享）   /   X（排他）   |
        +------------------------------+
                       |
                 实际加锁对象（行）
```
